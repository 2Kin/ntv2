{% extends '::layout.html.twig' %}

{% block title %}NinjaTooken - Guide du débutant{% endblock %}
{% block description %}NinjaTooken - jouer gratuitement{% endblock %}
{% block keywords %}NinjaTooken - jouer gratuitement{% endblock %}

{% block breadcrumbs1 %}

							<span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
								<span itemprop="title">Mon compte</span>
							</span>
{% endblock %}

{% block breadcrumbs2 %}
							<span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
								<a href="{{ path('ninja_tooken_user_messagerie') }}" itemprop="url">
									<span itemprop="title">Messagerie</span>
								</a>
							</span>
{% endblock %}

{% block body %}
				<div class="row-fluid">
					<aside class="span4">
						<a href="{{ path('ninja_tooken_user_messagerie_ajouter') }}" class="button mini">Nouveau Message</a><br><br>
						<h3><i class="icon-inbox"></i> Boîte <a href="#" class="actif">Réception</a> - <a href="#"><i class="icon-reply"></i> Envoie</a></h3>
						{% if messages is not empty %}
							{% set dateActu = '' %}
							{% for message in messages %}
								{% if dateActu|date("m/d/Y") != message.m_dateAjout|date("m/d/Y") %}
									{% set dateActu = message.m_dateAjout %}
									{% if dateActu|date("m/d/Y") == "now"|date("m/d/Y") %}
						<h4>Aujourd'hui</h4>
									{% elseif dateActu|date("m/d/Y") == "yesterday"|date("m/d/Y") %}
						<h4>Hier</h4>
									{% else %}
						<h4>{{ dateActu|localizeddate('full', 'none', app.request.locale) }}</h4>
									{% endif %}
								{% endif %}
						<div class="messagerie">
							<a href="{{ path('ninja_tooken_user_messagerie_supprimer', {message_id:message.m_id}) }}" class="pull-right"><i class="icon-trash"></i></a>
							<a href="{{ path('ninja_tooken_user_messagerie_voir', {message_id:message.m_id, 'page':page}) }}"{% if app.request.requesturi==path('ninja_tooken_user_messagerie_voir', {message_id:message.m_id}) or currentmessage.id==message.m_id %} class="actif"{% endif %}>{% if message.mu_dateRead|date('Y') == '-0001' %}<i class="icon-eye-open"></i> {% endif %}{{ message.m_dateAjout|localizeddate('none', 'short', app.request.locale) }} <strong>{{ message.u_username }}</strong>, {{ message.m_nom }}</a>
						</div>
							{% endfor %}

						{% include 'pagination.html.twig' with {
							currentPage: page,
							paginationPath: path('ninja_tooken_user_messagerie', {'page': ''}),
							paginationAfter: '',
							lastPage: nombrePage
						} only %}
						{% else %}
						<h4>Vous n'avez pas reçu de message</h4>
						{% endif %}
					</aside>
					<section class="span8">
						{% if currentmessage is not empty %}
						<article itemscope itemtype="http://schema.org/Article">
							<header>
								<span itemprop="creator" itemscope itemtype="http://schema.org/Person">
									<img src="{{ asset('bundles/ninjatookencommon/images/avatar.jpg') }}" itemprop="image" class="pull-left" alt="">
									<a href="{{ path('ninja_tooken_user_fiche', {user_nom:currentmessage.user.slug}) }}" rel="author" itemprop="url">
										<span itemprop="name">{{ currentmessage.user.username }}</span>
									</a>
								</span>
								<time itemprop="datePublished" datetime="{{ currentmessage.dateAjout|date("Y-m-d\\TH:i:sP") }}">le {{ currentmessage.dateAjout|localizeddate('full', 'none', app.request.locale) }} à {{ currentmessage.dateAjout|localizeddate('none', 'short', app.request.locale) }}</time><br>
								<h3 itemprop="headline">{{ currentmessage.nom }}</h3>
							</header>
							<div class="content" itemprop="articleBody">
								{{ currentmessage.content|raw|purify('full') }}
							</div>
						</article>
						<hr>
						<form action="#" method="post" accept-charset="UTF-8" class="full">
							<div class="row-fluid">
								<div class="span3"><label class="libelle required">Destinataire(s)</label></div>
								<div class="span9">
									<ul id="destinations" class="fake-input" data-find="{{ path('ninja_tooken_user_find') }}">
										<li>{{ currentmessage.user.username }}</li>
									</ul>
								</div>
							</div>
							<div class="row-fluid">
								<div class="span3"><label class="libelle required" for="sujet">Sujet</label></div>
								<div class="span9">
									<input type="text" name="sujet" id="sujet" value="{{ currentmessage.nom }}" class=""/>
								</div>
							</div>
							<div class="row-fluid">
								<div class="span3"><label class="libelle required" for="message">Message</label></div>
								<div class="span9">
									<div class="textarea" name="message">&nbsp;</div>
								</div>
							</div>
							<div class="row-fluid">
								<div class="span9 offset3">
									<input type="submit" value="Répondre" class="button">
								</div>
							</div>
						</form>
						{% else %}
						<h5>Aucun message sélectionné.</h5>
						{% endif %}
					</section>
				</div>
{% endblock %}
